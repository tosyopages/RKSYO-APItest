<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カスタム購入フォーム</title>
  <style>
    img {
      width: 200px;
      cursor: pointer;
      margin: 10px;
    }
    .form-section {
      margin-bottom: 30px;
    }
  </style>
</head>
<body>

<!-- 共通：画像URL入力 & プレビュー -->
<h2>画像を選択してください</h2>
<label>販売元</label>
<input type="text" id="global_client" required>
<label>選択された画像URL（image_url）:</label>
<input type="text" id="global_image_url" required>
<br>
<img id="global_result_image" src="" alt="表示される画像">
<br><br>
<hr>
<!-- アクリルキーホルダー -->
<div class="form-section">
  <h2>アクリルキーホルダー</h2>
  <form method="post" action="https://tosyoteststore5.myshopify.com/cart/add" class="custom-form tshirt-form">
    <label for="size_select">サイズを選んでください：</label>
    <select id="size_select">
      <option value="42581838889041">50mm角内</option>
      <option value="42581838921809">70mm角内</option>
      <option value="42581838954577">100mm角内</option>
    </select>
    <br><br>
    <input type="hidden" class="variant_id_input" name="id" value="">
    <input type="hidden" class="image_url_input" name="properties[image_url]" value="">
     <input type="hidden" class="client_input" name="properties[client]" value="">
    <button type="submit">カートに追加</button>
  </form>
</div>
<hr>

<!-- マグカップ -->
<div class="form-section">
  <h2>マグカップ</h2>
  <form method="post" action="https://tosyoteststore5.myshopify.com/cart/add" class="custom-form" data-fixed-id="42581802025041">
    <input type="hidden" class="variant_id_input" name="id" value="">
    <input type="hidden" class="image_url_input" name="properties[image_url]" value="">
     <input type="hidden" class="client_input" name="properties[client]" value="">
    <button type="submit">カートに追加</button>
  </form>
</div>
<hr>
<!-- Tシャツ（サイズ選択） -->
<div class="form-section">
  <h2>Tシャツ</h2>
  <form method="post" action="https://tosyoteststore5.myshopify.com/cart/add" class="custom-form tshirt-form">
    <label for="size_select">サイズを選んでください：</label>
    <select id="size_select">
      <option value="42581234155601">S</option>
      <option value="42581234188369">M</option>
      <option value="42581234221137">L</option>
      <option value="42581234253905">XL</option>
    </select>
    <br><br>
    <input type="hidden" class="variant_id_input" name="id" value="">
    <input type="hidden" class="image_url_input" name="properties[image_url]" value="">
     <input type="hidden" class="client_input" name="properties[client]" value="">
    <button type="submit">カートに追加</button>
  </form>
</div>
<hr>
<!-- ホワイトステッカー -->
<div class="form-section">
  <h2>ホワイトステッカー</h2>
  <form method="post" action="https://tosyoteststore5.myshopify.com/cart/add" class="custom-form tshirt-form">
    <label for="size_select">サイズを選んでください：</label>
    <select id="size_select">
      <option value="42581839544401">50mm角内</option>
      <option value="42581839577169">70mm角内</option>
      <option value="42581839609937">100mm角内</option>
    </select>
    <br><br>
    <input type="hidden" class="variant_id_input" name="id" value="">
    <input type="hidden" class="image_url_input" name="properties[image_url]" value="">
     <input type="hidden" class="client_input" name="properties[client]" value="">
    <button type="submit">カートに追加</button>
  </form>
</div>
<hr>

<!--スクリプト-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const params = new URLSearchParams(window.location.search);
    const imageUrlParam = params.get("image");
    const clientParam = params.get("client");

    const globalInput = document.getElementById("global_image_url");
    const globalImg = document.getElementById("global_result_image");
    const globalClientInput = document.getElementById("global_client");

    // クエリからimageがあれば反映
    if (imageUrlParam) {
      globalInput.value = decodeURIComponent(imageUrlParam);
      globalImg.src = decodeURIComponent(imageUrlParam);
    }

    // クエリからclientがあれば反映
    if (clientParam) {
      globalClientInput.value = decodeURIComponent(clientParam);
    }

    // 入力や変更があったとき、すべてのフォームに反映
    function updateForms() {
      const imageValue = globalInput.value;
      const clientValue = globalClientInput.value;

      document.querySelectorAll(".custom-form").forEach(form => {
        const imageInput = form.querySelector(".image_url_input");
        const clientInput = form.querySelector(".client_input");
        const variantInput = form.querySelector(".variant_id_input");
        const fixedId = form.dataset.fixedId;

        if (imageInput) imageInput.value = imageValue;
        if (clientInput) clientInput.value = clientValue;

        if (fixedId) {
          variantInput.value = fixedId;
        } else if (form.classList.contains("tshirt-form")) {
          const selected = document.getElementById("size_select").value;
          variantInput.value = selected;
        }
      });

      globalImg.src = imageValue;
    }

    // 初期反映
    updateForms();

    // 入力の変更を反映
    globalInput.addEventListener("input", updateForms);
    globalClientInput.addEventListener("input", updateForms);
    document.getElementById("size_select").addEventListener("change", updateForms);
  });
</script>


</body>
</html>
