<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カスタム購入フォーム</title>
  <style>
    img {
      width: 200px;
      cursor: pointer;
      margin: 10px;
    }
    .form-section {
      margin-bottom: 30px;
    }
  </style>
</head>
<body>

<!-- 共通：画像URL入力 & プレビュー -->
<h2>画像を選択してください</h2>
<label>販売元</label>
<input type="text" id="global_client" required>
<label>選択された画像URL（image_url）:</label>
<input type="text" id="global_image_url" required>
<br>
<img id="global_result_image" src="" alt="表示される画像">
<br><br>

<!-- アクリルキーホルダー -->
<div class="form-section">
  <h2>アクリルキーホルダー</h2>
  <form method="post" action="https://tosyoteststore5.myshopify.com/cart/add" class="custom-form" data-fixed-id="42575178268753">
    <input type="hidden" class="variant_id_input" name="id" value="">
    <input type="hidden" class="image_url_input" name="properties[image_url]" value="">
    <button type="submit">カートに追加</button>
  </form>
</div>

<!-- マグカップ -->
<div class="form-section">
  <h2>マグカップ</h2>
  <form method="post" action="https://tosyoteststore5.myshopify.com/cart/add" class="custom-form" data-fixed-id="42581802025041">
    <input type="hidden" class="variant_id_input" name="id" value="">
    <input type="hidden" class="image_url_input" name="properties[image_url]" value="">
    <button type="submit">カートに追加</button>
  </form>
</div>

<!-- Tシャツ（サイズ選択） -->
<div class="form-section">
  <h2>Tシャツ</h2>
  <form method="post" action="https://tosyoteststore5.myshopify.com/cart/add" class="custom-form tshirt-form">
    <label for="size_select">サイズを選んでください：</label>
    <select id="size_select">
      <option value="42581234155601">S</option>
      <option value="42581234188369">M</option>
      <option value="42581234221137">L</option>
      <option value="42581234253905">XL</option>
    </select>
    <br><br>
    <input type="hidden" class="variant_id_input" name="id" value="">
    <input type="hidden" class="image_url_input" name="properties[image_url]" value="">
    <button type="submit">カートに追加</button>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const params = new URLSearchParams(window.location.search);
    const imageUrlParam = params.get("image");
    const globalInput = document.getElementById("global_image_url");
    const globalImg = document.getElementById("global_result_image");

    if (imageUrlParam) {
      globalInput.value = decodeURIComponent(imageUrlParam);
      globalImg.src = decodeURIComponent(imageUrlParam);
    }

    // 入力や変更があったとき、すべてのフォームに反映
    function updateForms() {
      const value = globalInput.value;
      document.querySelectorAll(".custom-form").forEach(form => {
        const input = form.querySelector(".image_url_input");
        input.value = value;

        const fixedId = form.dataset.fixedId;
        const variantInput = form.querySelector(".variant_id_input");

        if (fixedId) {
          variantInput.value = fixedId;
        } else if (form.classList.contains("tshirt-form")) {
          const selected = document.getElementById("size_select").value;
          variantInput.value = selected;
        }
      });

      globalImg.src = value;
    }

    // 初期反映
    updateForms();

    // 入力の変更を反映
    globalInput.addEventListener("input", updateForms);
    document.getElementById("size_select").addEventListener("change", updateForms);
  });
</script>

</body>
</html>
